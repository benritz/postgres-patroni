scope: pgcluster
namespace: /pg_cluster/
name: pgcluster01

log:
  format: "%(asctime)s %(levelname)s: %(message)s"
  # ERROR INFO DEBUG
  level: ERROR
  max_queue_size: 1000
  traceback_level: ERROR
  type: plain

restapi:
  listen: 0.0.0.0:8008
  connect_address: ${IP_NODO_1}:8008

etcd3:
  hosts:
    - ${IP_NODO_1}:2379
    - ${IP_NODO_2}:2379

bootstrap:
  dcs:
    ttl: 30
    loop_wait: 10
    retry_timeout: 10
    maximum_lag_on_failover: 1048576
  postgresql:
    use_pg_rewind: true
    use_slots: true
    parameters:
      password_encryption: scram-sha-256
      wal_level: hot_standby
      hot_standby: "on"
      max_connections: 100
      max_worker_processes: 8
      wal_keep_segments: 8
      max_wal_senders: 10
      max_replication_slots: 10
      max_prepared_transactions: 0
      max_locks_per_transaction: 64
      wal_log_hints: "on"
      track_commit_timestamp: "off"
      archive_mode: "on"
      archive_timeout: 1800s
      archive_command: mkdir -p ../wal_archive && test ! -f ../wal_archive/%f && cp %p ../wal_archive/%f
    recovery_conf:
      restore_command: cp ../wal_archive/%f %p
  initdb:
    - encoding: UTF8
    - data-checksums
  pg_hba:
    - host replication replicator 127.0.0.1/32 scram-sha-256
    - host replication replicator ${IP_NODO_1}/32 scram-sha-256
    - host replication replicator ${IP_NODO_2}/32 scram-sha-256
    # poi replicator
    - host replication ${NOME_DB_USER} ${IP_NODO_1}/32 trust
    - host replication ${NOME_DB_USER} ${IP_NODO_2}/32 trust
    - host all all 0.0.0.0/0 scram-sha-256
  users:
    admin:
      password: admin
      options:
        - createrole
        - createdb

postgresql:
  listen: 0.0.0.0:5432
  connect_address: ${IP_NODO_1}:5432
  data_dir: /var/lib/postgresql/data
  bin_dir: /usr/local/bin
  pgpass: /tmp/pgpass
  authentication:
    replication:
      username: ${NOME_DB_USER}
      password: ${DB_PASSWORD}
    superuser:
      username: ${NOME_DB_USER}
      password: ${DB_PASSWORD}
  tags:
    nofailover: false
    noloadbalance: false
    clonefrom: false
    nosync: false

watchdog:
  mode: "off"
  device: /dev/watchdog
  safety_margin: 5
